/**
 * @description 简单的 emmet 语法生成 html
 * @author da宗熊
 * @update 2015/12/10
 * @version 2.0.0
 */
;(function(l,p){function h(a,b){this.tag=b||"";this.parent=a;this.children=[];this.cls=[];this.atr={};this.id=null;this.repeat=1}function m(a,b,c){c=c||{};a=a.split("");var d=b||new h(null,""),e=g.until(a,n);b=b?d:d.newChild(c.tag);for(b.setHelper("setTag");e;){b.end(e.text.trim());switch(e.last){case "#":b.setHelper("setId");break;case ".":b.setHelper("addClass");break;case "*":b.setHelper("setRepeat");break;case "{":b.addChild(g.toKey(a,"}"));break;case "[":e=g.toKey(a,"]");b.setAttribute(g.str2Obj(e,
",","="));break;case ">":b=b.newChild(c.tag||"div");break;case "+":b=b.newSiblings(c.tag||"div");break;case "^":b=b.toParent();break;case "(":m(g.toNextBracket(a),b,c);break;case "`":b.addChild(g.toKey(a,"`"))}e=g.until(a,n)}return d}h.prototype={_helper:"setTag",setHelper:function(a){this._helper=a},end:function(){var a=this._helper;a&&(this[a].apply(this,arguments),this._helper=null)},setTag:function(a,b){if(a||b)this.tag=a||""},setId:function(a){this.id=a},setRepeat:function(a){this.repeat=+a},
addChild:function(a){this.children.push(a)},addClass:function(a){this.cls.push(a)},setAttribute:function(a,b){var c=this.atr;if(2<=arguments.length)c[a]=b;else if("object"===typeof a)for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d])},toParent:function(){return this.parent},newSiblings:function(a){var b=this.parent;a=new h(b,a||"");b.addChild(a);return a},newChild:function(a){a=new h(this,a||"");this.addChild(a);return a},toHtml:function(a,b){var c="";b=b||{};if(1<this.repeat)for(var d=1;d<=this.repeat;d++)c+=
this._toHtml(d,b);else c+=this._toHtml(a||1,b);return c},_toHtml:function(a,b){var c="",d=b.number?g.change$2Number:function(a){return a};if(this.tag){c+="<"+d(this.tag,a);this.id&&(c+=' id="'+d(this.id,a)+'"');if(0<this.cls.length)var e=this.cls.join(" "),c=c+(' class="'+d(e,a)+'"');for(var f in this.atr)this.atr.hasOwnProperty(f)&&(c+=" "+f+'="'+d(this.atr[f],a)+'"');c+=">"}f=0;for(var e=this.children.length,h=this.children,k;f<e;f++)k=h[f],c+="string"==typeof k?d(k,a):k.toHtml(a,b);this.tag&&(c+=
"</"+d(this.tag,a)+">");return c}};var g={toKey:function(a,b){var c,d=null,e=[],f=a[0],g=/^('|"|`)/.test(f);for(g&&a.shift();c=d,d=a.shift();){if(d===b&&"\\"!=c)if(g){if(c===f){e.pop();break}}else break;e.push(d)}return e.join("")},until:function(a,b){if(0>=a.length)return null;for(var c=null,d=[];(c=a.shift())&&(d.push(c),!b.test(c)););return 0<d.length?{last:0>=a.length?"":d.pop(),text:d.join("")}:null},str2Obj:function(a,b,c){a=a.split("");for(var d={};0<a.length;){var e=this.toKey(a,c).trim(),
f=a[0];/"|'/.test(f)?(a.shift(),f=this.toKey(a,f)):f=this.toKey(a,b);d[e]=f}return d},toNextBracket:function(a){for(var b=1,c=[],d,e;;){e=d;d=a.shift();switch(d){case ")":"\\"!=e&&b--;break;case "(":b++}if(0>=b||!d)break;else c.push(d)}return c.join("")},change$2Number:function(a,b){return a.replace(/\$+/g,function(a){a=a.length;var d=(b+"").length;return d>=a?b:Array(a-d+1).join(0)+b})}},n=/[#>`.*{(+^\[]/;l[p]={compile:function(a,b){b=b||{};b.tag=b.tag||"div";b.number=b.number||!1;return m(a,null,
b).toHtml(null,{number:b.number})}};l.util=g})(window,window.EMMET_NAME||"Emmet");
